<div class="container-fluid">

  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <h2>
              STELLENANZEIGE <%= @job.name %>
          </h2>
        </div>
        <div class="panel-body">
          <%= link_to jobs_path :rtype => session[:rtype], :page => session[:page] do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
          <% end %>
          <% if user_signed_in? %>
  	        <%= link_to new_webmaster_path :object_name => "Job", :object_id => @job.id, :user_id => current_user.id do %>
              <i class="btn btn-warning btn-lg glyphicon glyphicon-eye-open"></i>
            <% end %>
            <% if current_user.id == @job.company.user_id %>
    	        <%= link_to edit_job_path(@job) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
              <% end %>
    	        <%= link_to @job, method: :delete, data: { confirm: 'Are you sure?' } do %>
                <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <div class="panel-body">
	        <%= link_to @job.company do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
          <% end %>
          <b><%= @job.company.name %></b>
          <br><br>
          <blockquote>
    				<% if @job.company.avatar_file_name == nil %>
              <%= image_tag("company_a.png", :size => "200x200", class:"img-rounded" ) %>
            <% else %>
              <%= image_tag @job.company.avatar(:medium), class:"img-rounded"  %>
            <% end %>
    				<p><b>
    					Anzeigentext
    				</p></b>
    				<small><%= @job.tasks %></small>
    				<small><%= @job.company.category.name %></small>
        	</blockquote>
          <cite> <%= @job.company.name + " am " + @job.created_at.strftime("%d.%m.%Y") %></cite>        
        </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            DETAILS
        </h2>
      </div>
      <div class="panel-body">
				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-skills" href="#panel-element-skills"><h3>Wir erwarten</h3></a>
				<div id="panel-element-skills" class="panel-collapse collapse">
          <p>
						<%= @job.skills %>
					</p>
  			</div>
				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-offers" href="#panel-element-offers"><h3>Wir bieten</h3></a>
				<div id="panel-element-offers" class="panel-collapse collapse">
          <p>
						<%= @job.offers %>
					</p>
  			</div>
				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-contacts" href="#panel-element-contacts"><h3>Ihr Kontakt</h3></a>
				<div id="panel-element-contacts" class="panel-collapse collapse">
          <p>
						<%= @job.contacts %>
					</p>
  			</div>
				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-company" href="#panel-element-company"><h3>Weitere Informationen</h3></a>
				<div id="panel-element-company" class="panel-collapse collapse">
          <p>
            <% if @job.company.homepage != nil %>
              <%= link_to url_with_protocol(@job.company.homepage), :target => '_blank' do %>
                <i class="glyphicon glyphicon-home"></i> <%= url_with_protocol(@job.company.homepage) %>
              <% end %>
            <% end %>
					</p>
  			</div>
    	</div>
    </div>
  </div>
  <br>
        
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            ORTSANGABE
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            KONTAKT
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <%= form_tag request_path, :method => "get" do %>
            <div class="form-group">
              <% if @job.company.user.phone1 == "" %>
                <i class="glyphicon glyphicon-phone"></i>
                <%= @job.company.user.phone1 %><br>
              <% end %>
              <% if @job.company.user.phone2 == "" %>
              <i class="glyphicon glyphicon-phone"></i>
                <%= @job.company.user.phone2 %><br>
              <% end %>
              <i class="glyphicon glyphicon-envelope"></i>
              <%= @job.company.user.email %><br>
            </div>
            <div class="form-group">
              <%= label_tag "Betreff" %>
              <%= text_field_tag :header, @job.name, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= label_tag "Nachricht" %>
              <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= submit_tag "Senden", :name => nil, class:"btn btn-primary btn-lg" %>
            </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": <%= @job.company.latitude %>,
          "lng": <%= @job.company.longitude %>,
          "infowindow": "<%= @job.company.name %>"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>