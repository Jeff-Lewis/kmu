<div class="container-fluid">

  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <li_header>
              KLEINANZEIGE <%= @request.name %>
          </li_header>
        </div>
        <div class="panel-body">
          <%= link_to requests_path :rtype => session[:rtype], :page => session[:page] do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
          <% end %>
          <% if user_signed_in? %>
  	        <%= link_to new_webmaster_path :object_name => "Request", :object_id => @request.id, :user_id => current_user.id do %>
              <i class="btn btn-warning btn-lg glyphicon glyphicon-eye-open"></i>
            <% end %>
            <% if current_user.id == @request.user_id %>
    	        <%= link_to edit_request_path(@request) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
              <% end %>
    	        <%= link_to @request, method: :delete, data: { confirm: 'Are you sure?' } do %>
                <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
              <% end %>
            <% end %>
          <% end %>
        </div>
        <div class="panel-body">
          <% if @request.request_details != nil %>
            <%= carousel(@request.request_details, "medium") %>
          <% else %>
            <%= image_tag("request_a.png", :size => "200x200", class:"img-rounded" ) %>
          <% end %>
          <br><br>
          <b>Beschreibung</b><br>
    			<%= @request.description %>
          <br><br>
          <b>aufgegeben von:</b><br>
          <% if !@request.user.avatar_file_name %>
            <%= image_tag("user_a.png", :size => "100x100" , class:"img-rounded") %>
          <% else %>
            <%= image_tag @request.user.avatar(:thumb), class:"img-rounded" %>
          <% end %><br>
          <%= @request.user.name + " " + @request.user.lastname %>
    			<br><br>
          <%= @request.created_at.strftime("%d.%m.%Y") %>
        </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
          <% if user_signed_in? %>
            <% if current_user.id == @request.user_id %>
              <%= link_to new_request_detail_path :request_id => @request.id do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
          ZUSATZINFORMATIONEN
        </li_header>
      </div>
      <div class="panel-body">
      		<% @request.request_details.each do |bd| %>
            <div class="col-sm-6 col-md-4 col-lg-3">
              <div class="thumbnail" align="center">
                <anzeigetext>
      						<%= bd.name %>
                </anzeigetext>
        				<% if bd.avatar_file_name == nil %>
                  <%= image_tag("bid_a.png", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag bd.avatar(:medium), class:"img-rounded"  %>
                <% end %>
                <p>
                <ntext>
    						<%= bd.description %>
    						</ntext>
    						</p>
                <% if user_signed_in? %>
                  <% if current_user.id == @request.user_id %>
          	        <%= link_to edit_request_detail_path(bd) do %>
                      <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                    <% end %>
          	        <%= link_to bd, method: :delete, data: { confirm: 'Are you sure?' } do %>
                      <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                    <% end %>
                  <% end %>
                <% end %>
                <br><br>
      			  </div>
      			</div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
        
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
            ORTSANGABE
        </li_header>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
            KONTAKT
        </li_header>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <%= form_tag request_path, :method => "get" do %>
            <div class="form-group">
              <% if !@request.user.anonymous %>
                  <% if @request.user.phone1 == "" %>
                    <i class="glyphicon glyphicon-phone"></i>
                    <%= @request.user.phone1 %><br>
                  <% end %>
                  <% if @request.user.phone2 == "" %>
                  <i class="glyphicon glyphicon-phone"></i>
                    <%= @request.user.phone2 %><br>
                  <% end %>
                  <i class="glyphicon glyphicon-envelope"></i>
                  <%= @request.user.email %><br>
              <% else %>
                ***
              <% end %>
            </div>
            <div class="form-group">
              <%= label_tag "Betreff" %>
              <%= text_field_tag :header, @request.name, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= label_tag "Nachricht" %>
              <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= submit_tag "Senden", :name => nil, class:"btn btn-primary btn-lg" %>
            </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": <%= @request.user.latitude %>,
          "lng": <%= @request.user.longitude %>,
          "infowindow": "<%= @request.user.name + " " + @request.user.lastname %>"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>
