<% if $activeapps != nil %>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            ACCOUNT
            <% if @user.anonymous %>
              ********
            <% else %>
              <%= @user.name + " " + @user.lastname %>
            <% end %>
        </h2>
      </div>
      <div class="panel-body">
        <%= link_to users_path :page => session[:page] do %>
          <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
        <% end %>
        <% if user_signed_in? %>
	        <%= link_to new_favourit_path :object_name => "User", :object_id => @user.id, :user_id => current_user.id do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-star"></i>
          <% end %>
          <% if current_user.id == @user.id or current_user.superuser %>
  	        <%= link_to edit_user_path(@user) do %>
              <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
            <% end %>
  	        <%= link_to @user, method: :delete, data: { confirm: 'Are you sure?' } do %>
              <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
            <% end %>
          <% end %>
	        <%= link_to new_webmaster_path :object_name => "User", :object_id => @user.id, :user_id => current_user.id do %>
            <i class="btn btn-warning btn-lg pull-right glyphicon glyphicon-eye-open"></i>
          <% end %>
        <% end %>
      </div>
      <div class="panel-body">
				<% if @user.anonymous or @user.avatar_file_name == nil %>
          <%= image_tag("user_a.png", :size => "200x200", class:"img-rounded" ) %>
        <% else %>
          <%= image_tag @user.avatar(:medium), class:"img-rounded"  %>
          <br>
          <cite><%= @user.created_at.strftime("%d.%m.%Y") %></cite><br>
          <% if !@user.anonymous and @user.phone1 != nil %>
            <i class="glyphicon glyphicon-phone"></i><%= @user.phone1 %><br> 
          <% end %>
          <% if !@user.anonymous and @user.phone2 != nil %>
            <i class="glyphicon glyphicon-phone"></i><%= @user.phone2 %><br> 
          <% end %>
          <i class="glyphicon glyphicon-envelope"></i><%= @user.email %><br>
        <% end %>
        <br>
        <%= form_tag user_path, :method => "get" do %>
          <div class="form-group">
            <%= label_tag "Betreff" %>
            <% if user_signed_in? %>
              <%= text_field_tag :header, "Nachricht von "+ current_user.name + " " + current_user.lastname, class:"form-control" %>
            <% else %>
              <%= text_field_tag :header, "Nachricht von ...", class:"form-control" %>
            <% end %>
          </div>
          <div class="form-group">
            <%= label_tag "Nachricht" %>
            <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
          </div>
          <div class="form-group">
            <%= submit_tag "Senden", :name => nil , class:"btn btn-primary btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <br>

<% if !@user.anonymous %>
<% if $activeapps.include?("Services") %>
<div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_service_path :user_id => @user.id do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            ANGEBOTE
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.services.each do |us| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= us.name %>
                </div>
                <% if us.avatar_file_name == nil %>
                  <%= image_tag("service_a.png", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag us.avatar, :size => "200x200", class:"img-rounded"  %>
                <% end %>
                <p>
    						<%= align_text(us.description) %>
    						</p>
                <br><br>
      	        <%= link_to service_path(us) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <% if user_signed_in? %>
                  <% if current_user.id == @user.id %>
          	        <%= link_to edit_service_path(us) do %>
                      <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                    <% end %>
          	        <%= link_to us, method: :delete, data: { confirm: 'Are you sure?' } do %>
                      <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                    <% end %>
                  <% end %>
                <% end %>
                <br><br>
          		</div>
        		</div>
      		<% end %>
      </div>
      </div>
    </div>
  <br>
<% end %>
  
<% if $activeapps.include?("Institutionen") %>
<div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_company_path :user_id => @user.id do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            INSTITUTIONEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.companies.each do |uc| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= uc.name %>
                </div>
        				<% if uc.avatar_file_name == nil %>
                  <%= image_tag("company_a.png", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag uc.avatar, :size => "200x200", class:"img-rounded"  %>
                <% end %>
                <p>
    						<%= uc.category.name %>
    						</p>
                <p>
    						<%= align_text(uc.description) %>
    						</p>
    						<br>
      	        <%= link_to uc do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <br><br>
      			  </div>
      			</div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>
  
<% if $activeapps.include?("Kleinanzeigen") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_request_path(:rtype => "biete", :user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"> Anbieten</i>
              <% end %>
              <%= link_to new_request_path(:rtype => "suche", :user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"> Suchen</i>
              <% end %>
            <% end %>
          <% end %>
            KLEINANZEIGEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.requests.order(created_at: :desc).each do |ur| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= ur.rtype + " " + ur.name %>
                </div>
                <p>
    						<%= ur.description %>
    						</p>
    						<% ur.request_details.limit(1).each do |urd| %>
    						  <p>
                  <b><%= urd.name %><br></b>
          				<% if urd.avatar_file_name == nil %>
                    <%= image_tag("request_a.jpg", :size => "200x200", class:"img-rounded" ) %>
                  <% else %>
                    <%= image_tag urd.avatar, :size => "200x200", class:"img-rounded"  %>
                  <% end %>
                  </p>
    						<% end %>
    						<br>
      	        <%= link_to ur do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
      			    <br><br>
      			 </div>
      			</div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>

<% if $activeapps.include?("Mobilien") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_vehicle_path(:user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            MOBILIEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.vehicles.each do |uv| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= uv.name %>
                </div>
        				<% if uv.avatar_file_name == nil %>
                  <%= image_tag("vehicle_a.png", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag uv.avatar(:medium), class:"img-rounded"  %>
                <% end %>
                <p>
      						<%= uv.mob_category.name %>
    						</p>
                <p>
      						<%= align_text(uv.description) %>
    						</p>
    						<br>
      	        <%= link_to uv do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <br><br>
      			  </div>
      			 </div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>
  
<% if $activeapps.include?("Veranstaltungen") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_event_path(:user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            VERANSTALTUNGEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.events.each do |ue| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= ue.name %>
                </div>
        				<% if ue.avatar_file_name == nil %>
                  <%= image_tag("vehicle_a.png", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag ue.avatar, :size => "200x200", class:"img-rounded"  %>
                <% end %>
                <p>
      						<%= ue.ev_category.name %>
    						</p>
                <p>
    						<%= align_text(ue.description) %>
    						</p>
    						<br>
      	        <%= link_to ue do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <br><br>
      			  </div>
      			 </div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>

<% if $activeapps.include?("Sehenswürdigkeiten") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_hotspot_path(:user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            SEHENSWÜRDIGKEITEN / AUSFLUGSZIELE
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.hotspots.each do |uh| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= uh.name %>
                </div>
                <% uh.hotspot_details.limit(1).each do |uhd| %>
          				<% if uhd.avatar_file_name == nil %>
                    <%= image_tag("target_a.png", :size => "200x200", class:"img-rounded" ) %>
                  <% else %>
                    <%= image_tag uhd.avatar, :size => "200x200", class:"img-rounded"  %>
                  <% end %>
                <% end %>
                <p>
    						<%= align_text(uh.description) %>
    						</p>
    						<br>
      	        <%= link_to uh do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <br><br>
      			  </div>
      			 </div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>
  
<% if $activeapps.include?("Ausschreibungen") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @user.id %>
              <%= link_to new_bid_path(:user_id => current_user.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            AUSSCHREIBUNGEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @user.bids.each do |ub| %>
            <div class="col-md-4">
              <div class="thumbnail" align="center">
                <div class="anzeigetext">
      						<%= ub.name %>
                </div>
      				  <%= align_text(ub.description) %>
      				  <% ub.bid_details.limit(1).each do |ubd| %>
          				<% if ubd.avatar_file_name == nil %>
                    <%= image_tag("bid_a.png", :size => "200x200", class:"img-rounded" ) %>
                  <% else %>
                    <%= image_tag ubd.avatar, :size => "200x200", class:"img-rounded"  %>
                  <% end %>
    						<% end %>
    						<br>
      	        <%= link_to ub do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
                <% end %>
                <br><br>
      			  </div>
      			 </div>
      		<% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>

  <% if $activeapps.include?("Spenden") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            SPENDEN
        </h2>
      </div>
      <div class="panel-body">
  	    <% @user.donation_stats.each do |uds| %>
          <div class="col-md-4">
            <div class="thumbnail" align="center">
    					<%= uds.donation.company.name %>
              <div class="anzeigetext">
    						<%= uds.donation.name %>
              </div>
              <p>
  						<%= align_text(uds.donation.description) %>
  						</p>
              <% uds.donation.donation_details.limit(1).each do |udd| %>
        				<% if udd.avatar_file_name == nil %>
                  <%= image_tag("donation_a.jpg", :size => "200x200", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag udd.avatar, :size => "200x200", class:"img-rounded"  %>
                <% end %>
              <% end %>
              <br>
              Spendenbetrag <%= sprintf("%05.2f CHF", uds.amount) %> am <%= uds.created_at.strftime("%d.%m.%Y") %>
              <br><br>
    	        <%= link_to uds.donation do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
              <% end %>
              <br>
              <br>
            </div>
          </div>
        <% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>

<% if $activeapps.include?("Bewertungen") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            RATINGS
        </h2>
      </div>
      <div class="panel-body">
        <% @user.ratings.each do |ur| %>
          <div class="col-md-4">
            <div class="thumbnail" align="center">
              <% if ur.service.company_id != nil %>
      					<%= ur.service.company.name %>
              <% end %>
              <% if ur.service.user_id != nil %>
      					<%= ur.service.user.name + " " + ur.service.user.lastname %>
              <% end %>
              <div class="anzeigetext">
    						<%= ur.service.name %>
              </div>
              <p>
  						<%= align_text(ur.service.description) %>
              <% if ur.service.avatar == nil %>
                <%= image_tag("service_a.png", :size => "50x50" , class:"img-rounded") %>
              <% else %>
                <%= image_tag ur.service.avatar, :size => 200, class:"img-rounded" %>
              <% end %>
              <br><br>
              <% ur.user_rating.times do %>
                <% image_tag("rating_star.jpg", :size => "50x50" , class:"img-rounded") %>
                <i class="glyphicon glyphicon-star"></i>
              <% end %>
              <br>
              <%= ur.user_comment %>
              <br><br>
    	        <%= link_to ur.service do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
              <% end %>
            </div>
          </div>
        <% end %>
    	</div>
    </div>
  </div>
  <br>
  <% end %>

<% if $activeapps.include?("Favoriten") %>
	<div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h1>
        <%= link_to new_favourit_path do %>
          <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
        <% end %>
        Favoriten
        <span class="badge"><%= @favanz %></span>
        </h1>
      </div>
      <div class="panel-body">
        <% @user.favourits.each do |f| %>
          <div class="col-md-4">
            <div class="thumbnail" align="center">
              <div class="anzeigetext">
                <% @item = Object.const_get(f.object_name).find(f.object_id) %>
                <% if @item != nil %>
                  <% if f.object_name == "User" %>
                    <%= @item.name + " " + @item.lastname %>
                  <% else %>
                    <%= @item.name %>
                  <% end %>
                <% else %>
                  <%= f.object_name %><br>
                  <%= f.object_id %>
                <% end %>
              </div>

              <% if f.object_name == "User" or f.object_name == "Company" %>
                <% if @item.avatar != nil %>
                  <%= image_tag @item.avatar, :size => 200, class:"img-rounded" %>
                <% end %>
              <% end %>
              <% if f.object_name == "Donation" %>
                <% if @item.donation_details.first.avatar != nil %>
                  <%= image_tag @item.donation_details.first.avatar, :size => 200, class:"img-rounded" %>
                <% end %>
              <% end %>

              <br>
              <% if f.active %>
                <% image_tag("icon_active.jpg", :size => "50x50" , class:"img-rounded") %>
                 <i class="glyphicon glyphicon-ok-sign"></i> aktiv
              <% else %>
                <% image_tag("icon_inactive.jpg",:size => "50x50", class:"img-rounded") %>
                 <i class="glyphicon lg glyphicon-remove-sign"></i> inaktiv
              <% end %>
              <% if f.email %>
                <% image_tag("icon_active.jpg", :size => "50x50" , class:"img-rounded") %>
                 <i class="glyphicon glyphicon-ok-sign"></i> eMail
              <% end %>
              <% if f.ticker %>
                <% image_tag("icon_active.jpg", :size => "50x50" , class:"img-rounded") %>
                 <i class="glyphicon glyphicon-ok-sign"></i> Ticker
              <% end %>
              <br><br>
              <% if user_signed_in? %>
                <% if @user.id == current_user.id %>
        	        <%= link_to edit_favourit_path(f) do %>
                    <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                  <% end %>
        	        <%= link_to f, method: :delete, data: { confirm: 'Are you sure?' } do %>
                    <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                  <% end %>
                <% end %>
              <% end %>
              <br><br>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<br>
<% end %>
  
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            ORTSANGABE
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>
  <% end %>
</div>
<% end %>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": <%= @user.latitude %>,
          "lng": <%= @user.longitude %>,
          "infowindow": "<%= @user.name + " " + @user.lastname %>"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>