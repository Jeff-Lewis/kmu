<div class="container-fluid">

  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <h2>
              VERANSTALTUNG <%= @event.name %>
          </h2>
        </div>
        <div class="panel-body">
          <%= link_to events_path :page => session[:page] do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
          <% end %>
          <% if user_signed_in? %>
            <% if @event.user_id != nil %>
              <% if current_user.id == @event.user_id %>
      	        <%= link_to edit_event_path(@event) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                <% end %>
      	        <%= link_to @event, method: :delete, data: { confirm: 'Are you sure?' } do %>
                  <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
                <% end %>
              <% end %>
            <% end %>
            <% if @event.company_id != nil %>
              <% if current_user.id == @event.company.user_id %>
      	        <%= link_to edit_event_path(@event) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                <% end %>
      	        <%= link_to @event, method: :delete, data: { confirm: 'Are you sure?' } do %>
                  <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
                <% end %>
              <% end %>
            <% end %>
  	        <%= link_to new_webmaster_path :object_name => "Event", :object_id => @event.id, :user_id => current_user.id do %>
              <i class="btn btn-warning btn-lg pull-right glyphicon glyphicon-eye-open"></i>
            <% end %>
          <% end %>
        </div>
        <div class="panel-body">
    			<blockquote>
    				<% if @event.avatar_file_name == nil %>
              <%= image_tag("event_a.png", :size => "200x200", class:"img-rounded" ) %>
            <% else %>
              <%= image_tag @event.avatar(:medium), class:"img-rounded"  %>
            <% end %>
            <br><br>
    				<b>
    					Beschreibung
    				</b><br>
    				<small><%= @event.description %></small><br>
    				<b>Datum</b><br>
            vom <%= @event.date_from.strftime("%d.%m.%Y") + " bis " + @event.date_to.strftime("%d.%m.%Y") %>
        	</blockquote>
          <cite>vom <%= @event.created_at.strftime("%d.%m.%Y") %></cite>        
        </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if @event.user_id != nil %>
              <% if current_user.id == @event.user_id %>
                <%= link_to new_event_detail_path :event_id => @event.id do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
                <% end %>
              <% end %>
            <% end %>
            <% if @event.company_id != nil %>
              <% if current_user.id == @event.company.user_id %>
                <%= link_to new_event_detail_path :event_id => @event.id do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
            ZUSATZINFORMATIONEN
        </h2>
      </div>
      <div class="panel-body">
      		<% @event.event_details.each do |ed| %>
    				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-375571" href="#panel-element-<%= ed.id %>"><h3><%= ed.name %></h3></a>
    				<div id="panel-element-<%= ed.id %>" class="panel-collapse collapse">
      				<% if ed.avatar_file_name == nil %>
                <%= image_tag("event_a.png", :size => "200x200", class:"img-rounded" ) %>
              <% else %>
                <%= image_tag ed.avatar(:medium), class:"img-rounded"  %>
              <% end %>
              <p>
  						<%= ed.description %>
  						</p>
              <% if user_signed_in? %>
                <% if @event.user_id != nil %>
                  <% if current_user.id == @event.user_id %>
          	        <%= link_to edit_event_detail_path(ed) do %>
                      <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                    <% end %>
          	        <%= link_to ed, method: :delete, data: { confirm: 'Are you sure?' } do %>
                      <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                    <% end %>
                  <% end %>
                  <% if @event.company_id != nil %>
                    <% if current_user.id == @event.company.user_id %>
            	        <%= link_to edit_event_detail_path(ed) do %>
                        <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                      <% end %>
            	        <%= link_to ed, method: :delete, data: { confirm: 'Are you sure?' } do %>
                        <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                      <% end %>
                    <% end %>
                  <% end %>
                <% end %>
                <% if @event.company_id != nil %>
                  <% if current_user.id == @event.company.user_id %>
          	        <%= link_to edit_event_detail_path(ed) do %>
                      <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                    <% end %>
          	        <%= link_to ed, method: :delete, data: { confirm: 'Are you sure?' } do %>
                      <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
      			</div>
      		<% end %>
  				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-hotspot" href="#panel-element-hotspot"><h3>Weitere Informationen</h3></a>
  				<div id="panel-element-hotspot" class="panel-collapse collapse">
            <p>
              <% if @event.homepage != nil %>
                <%= link_to url_with_protocol(@event.homepage), :target => '_blank' do %>
                  <i class="glyphicon glyphicon-home"></i> <%= url_with_protocol(@event.homepage) %>
                <% end %>
              <% end %>
  					</p>
    			</div>
    	</div>
    </div>
  </div>
  <br>
  
  <% if $activeapps.include?("Sponsoring") %>
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if @event.user_id != nil %>
              <% if current_user.id == @event.user_id %>
                <%= link_to new_sponsor_path :event_id => @event.id do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
                <% end %>
              <% end %>
            <% end %>
            <% if @event.company_id != nil %>
              <% if current_user.id == @event.company.user_id %>
                <%= link_to new_sponsor_path :event_id => @event.id do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
            SPONSOREN
        </h2>
      </div>
      <div class="panel-body">
    		<% @event.sponsors.each do |es| %>
  				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-375572" href="#panel-sponsor-element-<%= es.id %>"><h3><%= es.company.name %></h3></a>
  				<div id="panel-sponsor-element-<%= es.id %>" class="panel-collapse collapse">
  				  <p>
    				<% case es.slevel %>
    				  <% when "1" %>
                <%= image_tag("Sponsor_gold.jpg", :size => "50x50", class:"img-rounded" ) %>
    				  <% when "2" %>
                <%= image_tag("Sponsor_silver.jpg", :size => "50x50", class:"img-rounded" ) %>
    				  <% when "3" %>
                <%= image_tag("Sponsor_bronze.jpg", :size => "50x50", class:"img-rounded" ) %>
            <% end %>
    				<% if es.company.avatar_file_name == nil %>
              <%= image_tag("company_a.png", :size => "200x200", class:"img-rounded" ) %>
            <% else %>
              <%= image_tag es.company.avatar(:medium), class:"img-rounded"  %>
            <% end %>
						</p>
            <% if es.company.homepage != nil %>
              <%= link_to url_with_protocol(es.company.homepage), :target => '_blank' do %>
                <i class="glyphicon glyphicon-home"></i> <%= url_with_protocol(es.company.homepage) %>
              <% end %>
            <% end %>
            <br>
  	        <%= link_to es.company do %>
              <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
            <% end %>
            <% if user_signed_in? %>
              <% if current_user.id == @event.user_id %>
      	        <%= link_to edit_sponsor_path(es) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                <% end %>
      	        <%= link_to es, method: :delete, data: { confirm: 'Are you sure?' } do %>
                  <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                <% end %>
              <% end %>
            <% end %>
    			</div>
    		<% end %>
      </div>
    </div>
  </div>
  <br>
  <% end %>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            ORTSANGABE
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            KONTAKT
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <%= form_tag @event_path, :method => "get" do %>
            <div class="form-group">
              <% if @event.user_id != nil %>
                <% if @event.user.phone1 == "" %>
                  <i class="glyphicon glyphicon-phone"></i>
                  <%= @event.user.phone1 %><br>
                <% end %>
                <% if @event.user.phone2 == "" %>
                <i class="glyphicon glyphicon-phone"></i>
                  <%= @event.user.phone2 %><br>
                <% end %>
                <i class="glyphicon glyphicon-envelope"></i>
                <%= @event.user.email %><br>
              <% end %>
            </div>
              <% if @event.company_id != nil %>
                <% if @event.company.user.phone1 == "" %>
                  <i class="glyphicon glyphicon-phone"></i>
                  <%= @event.company.user.phone1 %><br>
                <% end %>
                <% if @event.company.user.phone2 == "" %>
                <i class="glyphicon glyphicon-phone"></i>
                  <%= @event.company.user.phone2 %><br>
                <% end %>
                <i class="glyphicon glyphicon-envelope"></i>
                <%= @event.company.user.email %><br>
              <% end %>
            </div>
            <div class="form-group">
              <%= label_tag "Betreff" %>
              <%= text_field_tag :header, @event.name, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= label_tag "Nachricht" %>
              <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
            </div>
            <div class="form-group">
              <%= submit_tag "Senden", :name => nil, class:"btn btn-primary btn-lg" %>
            </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": <%= @event.latitude %>,
          "lng": <%= @event.longitude %>,
          "infowindow": "<%= @event.name %>"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>