<div class="container-fluid">

  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <h2>
              SEHENSWÃœRDIGKEIT 
              <%= @hotspot.name %>
          </h2>
        </div>
        <div class="panel-body">
            <%= link_to hotspots_path :page => session[:page] do %>
              <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
            <% end %>
            <% if  user_signed_in? %>
                <% if @hotspot.user_id == current_user.id %>
        	        <%= link_to edit_hotspot_path(@hotspot) do %>
                    <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                  <% end %>
        	        <%= link_to @hotspot, method: :delete, data: { confirm: 'Are you sure?' } do %>
                    <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
                  <% end %>
                <% end %>
      	        <%= link_to new_webmaster_path :object_name => "Hotspot", :object_id => @hotspot.id, :user_id => current_user.id do %>
                  <i class="btn btn-warning btn-lg pull-right glyphicon glyphicon-eye-open"></i>
                <% end %>
            <% end %>
        </div>
        <div class="panel-body">
    			<blockquote>
            <% if @hotspot.hotspot_details.first != nil %>
      				<% if @hotspot.hotspot_details.first.avatar_file_name == nil %>
                <%= image_tag("target_a.png", :size => "200x200", class:"img-rounded" ) %>
              <% else %>
                <%= image_tag @hotspot.hotspot_details.first.avatar(:medium), class:"img-rounded"  %>
              <% end %>
            <% end %>
      			<small><%= @hotspot.description %></small>
      			<br>
            <cite> <%= @hotspot.created_at.strftime("%d.%m.%Y") %></cite>        
        	</blockquote>
          <% if !@hotspot.user.avatar_file_name %>
            <%= image_tag("user_a.png", :size => "50x50" , class:"img-rounded") %>
          <% else %>
            <%= image_tag @hotspot.user.avatar(:small), class:"img-rounded" %>
          <% end %>
          <div class="anzeigetext">
            <%= @hotspot.user.name + " " + @hotspot.user.lastname %>
          </div><br>
          <%= link_to @hotspot.user do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-info-sign"></i>
          <% end %>
        </div>
      </div>
    </div>
    <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
          <% if user_signed_in? %>
            <% if current_user.id == @hotspot.user_id %>
              <%= link_to new_hotspot_detail_path :hotspot_id => @hotspot.id do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
          <% end %>
            DETAILS
        </h2>
      </div>
      <div class="panel-body">
      		<% @hotspot.hotspot_details.each do |ed| %>
    				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-375571" href="#panel-element-<%= ed.id %>"><h3><%= ed.name %></h3></a>
    				<div id="panel-element-<%= ed.id %>" class="panel-collapse collapse">
      				<% if ed.avatar_file_name == nil %>
                <%= image_tag("target_a.png", :size => "200x200", class:"img-rounded" ) %>
              <% else %>
                <%= image_tag ed.avatar(:medium), class:"img-rounded"  %>
              <% end %>
              <p>
  						<%= ed.description %>
  						</p>
              <% if user_signed_in? %>
                <% if current_user.id == @hotspot.user_id %>
        	        <%= link_to edit_hotspot_detail_path(ed) do %>
                    <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                  <% end %>
        	        <%= link_to ed, method: :delete, data: { confirm: 'Are you sure?' } do %>
                    <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                  <% end %>
                <% end %>
              <% end %>
      			</div>
      		<% end %>
  				<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-hotspot" href="#panel-element-hotspot"><h3>Weitere Informationen</h3></a>
  				<div id="panel-element-hotspot" class="panel-collapse collapse">
            <p>
              <% if @hotspot.homepage != nil %>
                <%= link_to url_with_protocol(@hotspot.homepage), :target => '_blank' do %>
                  <i class="glyphicon glyphicon-home"></i> <%= url_with_protocol(@hotspot.homepage) %>
                <% end %>
              <% end %>
  					</p>
    			</div>
    	</div>
    </div>
  </div>
  <br>
          
  <% if $activeapps.include?("Bewertungen") %>
  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <h2>
            <% if user_signed_in? %>
              <%= link_to new_hs_rating_path(:user_id => current_user.id, :hotspot_id => @hotspot.id) do %>
                <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
              <% end %>
            <% end %>
            Bewertungen
          </h2>
        </div>
        <div class="panel-body">
            <% if @hotspot.hs_ratings.count > 0 %>
        			<a class="panel-title collapsed" data-toggle="collapse" data-parent="#panel-rating" href="#panel-element-rating"><h3>Bewertungen (<%= @hotspot.hs_ratings.count.to_s %>)</h3></a>
        			<div id="panel-element-rating" class="panel-collapse collapse">
  						<table class="table table striped">
  						  <thead>
  						    <tr>
      						  <th colspan="2">
      						    Bewertung
      						  </th>
      						  <th>
      						    Kommentar
      						  </th>
      						  <th>
      						    Benutzer
      						  </th>
      						  <th>
      						    Datum
      						  </th>
                  </tr>
                </thead>
                <tbody>
                <% @hotspot.hs_ratings.each do |usr| %>
                  <tr>
                    <td>
                    <% if user_signed_in? %>
                      <% if (usr.user_id == current_user.id) %>
              	        <%= link_to edit_hs_rating_path(usr) do %>
                          <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                        <% end %>
              	        <%= link_to usr, method: :delete, data: { confirm: 'Are you sure?' } do %>
                          <i class="btn btn-danger btn-lg glyphicon glyphicon-trash"></i>
                        <% end %>
                      <% end %>
                    <% end %>
                    </td>
                    <td>
                      <% usr.user_rating.times do %>
                        <%= image_tag("rating_star.jpg", :size => "50x50" , class:"img-rounded") %>
                      <% end %><br>
                    </td>
                    <td>
                      <%= usr.user_comment %>
                    </td>
                    <td>
                      <%= usr.user.name + " " + usr.user.lastname %>
                    </td>
                    <td>
                      <%= usr.created_at.strftime("%d.%m.%Y") %>
                    </td>
                  </tr>
                <% end %>
                </tbody>
  						</table>
  						</div>
  					<% end %>
        </div>
    </div>
  </div>
  <br>
  <% end %>
  
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            ORTSANGABE
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h2>
            KONTAKT
        </h2>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <%= form_tag request_path, :method => "get" do %>
          <div class="form-group">
            <% if @hotspot.user.phone1 == "" %>
              <i class="glyphicon glyphicon-phone"></i>
              <%= @hotspot.user.phone1 %><br>
            <% end %>
            <% if @hotspot.user.phone2 == "" %>
            <i class="glyphicon glyphicon-phone"></i>
              <%= @hotspot.user.phone2 %><br>
            <% end %>
            <i class="glyphicon glyphicon-envelope"></i>
            <%= @hotspot.user.email %><br>
          </div>
          <div class="form-group">
            <%= label_tag "Betreff" %>
            <%= text_field_tag :header, @hotspot.name, class:"form-control" %>
          </div>
          <div class="form-group">
            <%= label_tag "Nachricht" %>
            <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
          </div>
          <div class="form-group">
            <%= submit_tag "Senden", :name => nil, class:"btn btn-primary btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
        <% if @hotspot.latitude != nil and @hotspot.longitude != nil %>
          "lat": <%= @hotspot.latitude %>,
          "lng": <%= @hotspot.longitude %>,
          "infowindow": "<%= @hotspot.name %>"
         <% end %>
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>