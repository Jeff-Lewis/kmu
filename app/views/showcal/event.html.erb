<div class="container-fluid">
	<div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <h1>
		    <% if user_signed_in? %>
		        <%= link_to searches_path :search_domain => "Veranstaltungen", :controller_name => controller_name do %>
		          <i class="btn btn-primary btn-lg glyphicon glyphicon-filter"></i>
		        <% end %>
		    <% end %>
        VERANSTALTUNGEN
        <span class="badge"><%= @eveanz %></span>
        <%= link_to events_path(:page => session[:page], :dir => "<")  do %>
          <i class="btn btn-primary btn-lg glyphicon glyphicon-chevron-left"></i>
        <% end %>
        KW <%= session[:cw].to_s + " / " + session[:year].to_s %>
        <%= link_to events_path(:page => session[:page], :dir => ">")  do %>
          <i class="btn btn-primary btn-lg glyphicon glyphicon-chevron-right"></i>
        <% end %>
        </h1>
      </div>
    </div>
  </div>
	<div class="row">
    <div class="col-md-12">
  		<table class="table table-striped">
        <thead>
          <tr>
            <td colspan="12">
              <div class="digg_pagination">
                  <%= will_paginate @events, :container => false, previous_label: "<", next_label: ">" %>
              </div>	  
            </td>
          </tr>
          <tr>
            <th colspan="3">Veranstaltung</th>
            <% for i in 0..6 %>
              <th>
                <%= $wochentage[i] %><br>
                <%= (@start+i).strftime("%d.%m") %>
              </th>
            <% end %>
          </tr>
        </thead>
        
        <tbody>

            <% @events.each do |e| %>

              <tr>
    				    <td>
                <% if e.date_to != nil %>
                    <b><ntext>noch </ntext></b><restlaufzeit><%= (e.date_to.to_date - DateTime.now.to_date).to_i.to_s %></restlaufzeit> <b><ntext> Tage</ntext></b>
                <% end %>
    				    </td>
    				    <td>
    				    <%= link_to e do %>
                  <% if e.event_details != nil %>
                        <%= carousel(e.event_details, "thumb") %>
                      <% else %>
                        <%= image_tag("event_a.png", :size => "100x100", class:"img-rounded" ) %>
              		<% end %>
                <% end %>
                </td>
                <td>
              	      <anzeigetext>
                        <%= e.name %></br>
                      </anzeigetext>
                      <ntext>
                      <% if e.company_id != nil %>
                        <%= e.company.name %>
                      <% end %>
                      <% if e.user_id != nil %>
                        <%= e.user.name + " " + e.user.lastname %>
                      <% end %>
                      <%= e.date_from.strftime("%d.%m") %>-<%= e.date_to.strftime("%d.%m") %>
                      </ntext>
        				</td>
                <% for i in 0..6 %>
                    <% if EventDatum(@start+i,e) %>
                      <td class="blocked">
                    <% else %>
                      <td class="free">
                    <% end %>
                    </th>
                <% end %>

              </tr>

            <% end %>

        </tbody>
      </table>
    </div>
  </div>
  
	<div class="row">
    <div class="col-md-12">
      <div id="map">
      </div>
    </div>
  </div>
    
</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>