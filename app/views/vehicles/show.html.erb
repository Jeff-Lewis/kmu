<div class="container-fluid">

  <div class="row">
    <div class="col-md-12">
        <div class="panel-heading header">
          <li_header>
              MOBILIEN <%= @vehicle.name %>
          </li_header>
        </div>
        <div class="panel-body">
          <%= link_to vehicles_path :page => session[:page] do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-list"></i>
          <% end %>
          <% if user_signed_in? %>
            <% if @vehicle.user_id != nil %>
              <% if current_user.id == @vehicle.user.id %>
      	        <%= link_to edit_vehicle_path(@vehicle) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                <% end %>
      	        <%= link_to @vehicle, method: :delete, data: { confirm: 'Are you sure?' } do %>
                  <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
                <% end %>
              <% end %>
            <% end %>
            <% if @vehicle.company_id != nil %>
              <% if current_user.id == @vehicle.company.user.id %>
                <%= link_to new_vehicle_path :user_id => current_user.id do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-plus"></i>
                <% end %>
      	        <%= link_to edit_vehicle_path(@vehicle) do %>
                  <i class="btn btn-primary btn-lg glyphicon glyphicon-wrench"></i>
                <% end %>
      	        <%= link_to @vehicle, method: :delete, data: { confirm: 'Are you sure?' } do %>
                  <i class="btn btn-danger btn-lg pull-right glyphicon glyphicon-trash"></i>
                <% end %>
              <% end %>
            <% end %>
  	        <%= link_to new_webmaster_path :object_name => "Vehicle", :object_id => @vehicle.id, :user_id => current_user.id do %>
              <i class="btn btn-warning btn-lg pull-right glyphicon glyphicon-eye-open"></i>
            <% end %>
          <% end %>
        </div>
        <div class="panel-body">
  				<% if @vehicle.avatar_file_name == nil %>
            <%= image_tag("vehicle_a.png", :size => "200x200", class:"img-rounded" ) %>
          <% else %>
            <%= image_tag @vehicle.avatar(:medium), class:"img-rounded"  %>
          <% end %>
      		<%= @vehicle.description %>
      		<br><br>
          <b>Mobilienkategorie</b><br>
          <%= @vehicle.mob_category.name %>
          <br><br>
          <b>Mietzeiten</b><br>
          <%= @vehicle.time_from %> - 
          <%= @vehicle.time_to %> Uhr
          <br><br>
          <b>Standort</b><br>
          <%= @vehicle.address1 %><br>
          <%= @vehicle.address2 %><br>
          <%= @vehicle.address3 %><br>
          <br>
          <b>vermietet von</b><br>
          <% if @vehicle.user_id != nil %>
    				<% if @vehicle.user.avatar_file_name == nil %>
              <%= image_tag("user_a.png", :size => "100x100", class:"img-rounded" ) %>
            <% else %>
              <%= image_tag @vehicle.user.avatar(:thumb), class:"img-rounded"  %>
            <% end %>
            <%= @vehicle.user.name + " " + @vehicle.user.lastname %>
          <% end %>
          <% if @vehicle.company_id != nil %>
    				<% if @vehicle.company.avatar_file_name == nil %>
              <%= image_tag("user_a.png", :size => "100x100", class:"img-rounded" ) %>
            <% else %>
              <%= image_tag @vehicle.company.avatar(:thumb), class:"img-rounded"  %>
            <% end %>
            <%= @vehicle.company.name %>
          <% end %>
          <br><br>
          <cite> <%= @vehicle.created_at.strftime("%d.%m.%Y") %></cite>        
        </div>
    </div>
  </div>
  <br>
  
  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
          <%= link_to calenders_path :vehicle_id => @vehicle.id do %>
            <i class="btn btn-primary btn-lg glyphicon glyphicon-calendar"></i>
          <% end %>
            VERMIETUNGEN
        </li_header>
      </div>
      <% if @vehicle.calenders.count > 0 %>
  			<table class="table table striped">
  			  <thead>
  			    <tr>
  					  <th colspan="3">
  					    Benutzer
  					  </th>
  					  <th colspan="2">
  					    Mietzeitraum
  					  </th>
  					  <th>
  					    Datum
  					  </th>
            </tr>
          </thead>
          <tbody>
            <% @vehicle.calenders.each do |vc| %>
              <tr>
                <td>
        				<% if vc.user.avatar_file_name == nil %>
                  <%= image_tag("user_a.png", :size => "50x50", class:"img-rounded" ) %>
                <% else %>
                  <%= image_tag vc.user.avatar(:small), class:"img-rounded"  %>
                <% end %>
                </td>
                <td><%= vc.user.name + " " + vc.user.lastname %></td>
                <td><%= vc.date_from.strftime("%d.%m.%Y") %></td>
                <td><%= vc.date_to.strftime("%d.%m.%Y") %></td>
                <td><%= vc.created_at.strftime("%d.%m.%Y") %></td>
              </tr>
            <% end %>
          </tbody>
  			</table>
  		<% end %>
  	</div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
            ORTSANGABE
        </li_header>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <div id="map">
          <div id="map-canvas"></div>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div class="row">
    <div class="col-md-12">
      <div class="panel-heading header">
        <li_header>
            KONTAKT
        </li_header>
      </div>
    </div>
    <div class="col-md-12">
      <div class="panel-body">
        <%= form_tag request_path, :method => "get" do %>
          <% if @vehicle.user_id != nil %>
            <div class="form-group">
              <% if @vehicle.user.phone1 == "" %>
                <i class="glyphicon glyphicon-phone"></i>
                <%= @vehicle.user.phone1 %><br>
              <% end %>
              <% if @vehicle.user.phone2 == "" %>
              <i class="glyphicon glyphicon-phone"></i>
                <%= @vehicle.user.phone2 %><br>
              <% end %>
              <i class="glyphicon glyphicon-envelope"></i>
              <%= @vehicle.user.email %><br>
            </div>
          <% end %>
          <% if @vehicle.company_id != nil %>
            <div class="form-group">
              <% if @vehicle.company.user.phone1 == "" %>
                <i class="glyphicon glyphicon-phone"></i>
                <%= @vehicle.company.user.phone1 %><br>
              <% end %>
              <% if @vehicle.company.user.phone2 == "" %>
              <i class="glyphicon glyphicon-phone"></i>
                <%= @vehicle.company.user.phone2 %><br>
              <% end %>
              <i class="glyphicon glyphicon-envelope"></i>
              <%= @vehicle.company.user.email %><br>
            </div>
          <% end %>
          <div class="form-group">
            <%= label_tag "Betreff" %>
            <%= text_field_tag :header, @vehicle.name, class:"form-control" %>
          </div>
          <div class="form-group">
            <%= label_tag "Nachricht" %>
            <%= text_area_tag :body, params[:body], rows: 5, class:"form-control" %>
          </div>
          <div class="form-group">
            <%= submit_tag "Senden", :name => nil, class:"btn btn-primary btn-lg" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

</div>

<script>
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers([
        {
          "lat": <%= @vehicle.latitude %>,
          "lng": <%= @vehicle.longitude %>,
          "infowindow": "<%= @vehicle.name %>"
        }
      ]);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
});
</script>